import wx
import os
import win32com.client as win32
from bnyCompliance.ReportOpener.excelcomm import openWorkbook

def OpenFileExcel(self, *args, **kwargs):
    """
    allows user to select the directory
    """
    directory = None
    if kwargs is not None:
        for key, value in kwargs.items():
            if key == 'directory':
                directory = value



    with wx.FileDialog(self, "Open report file", directory,
                       wildcard="excel files (*.xlsx)|*.xlsx|(*.xls)|*.xlsx|(*.csv)|*.csv",
                       style=wx.FD_OPEN) as fileDialog:
        
        if fileDialog.ShowModal() == wx.ID_CANCEL:
            return 


        else:

            pathname = fileDialog.GetPath()
            print('the file to be opened is :'+ pathname)

            def openWorkbook(xlapp, xlfile):
                try:
                    xlwb = xlapp.Workbooks(xlfile)
                except Exception as e:
                    try:
                        xlwb = xlapp.Workbooks.Open(xlfile)
                    except Exception as e:
                        print(e)
                        xlwb = None
                return (xlwb)

            pathname = os.path.normcase(pathname)


            try:
                excel = win32.gencache.EnsureDispatch('Excel.Application')
                wb = openWorkbook(excel, pathname)
                #ws = wb.Worksheets('Sheet1')
                excel.Visible = True
            except Exception as e:
                print(e)

            finally:
                # RELEASES RESOURCES
                ws = None
                wb = None
                excel = None

def main():
    pass

if __name__ == "__main__":
   # stuff only to run when not called via 'import' here
   main()
